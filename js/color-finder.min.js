var MMCQ=function(){function r(r,o,t){return(r<<2*c)+(o<<c)+t}function o(r){function o(){t.sort(r),n=!0}var t=[],n=!1;return{push:function(r){t.push(r),n=!1},peek:function(r){return n||o(),void 0===r&&(r=t.length-1),t[r]},pop:function(){return n||o(),t.pop()},size:function(){return t.length},map:function(r){return t.map(r)},debug:function(){return n||o(),t}}}function t(r,o,t,n,e,i,a){var u=this;u.r1=r,u.r2=o,u.g1=t,u.g2=n,u.b1=e,u.b2=i,u.histo=a}function n(){this.vboxes=new o(function(r,o){return f.naturalOrder(r.vbox.count()*r.vbox.volume(),o.vbox.count()*o.vbox.volume())})}function e(o){var t,n,e,i,a=1<<3*c,u=new Array(a);return o.forEach(function(o){n=o[0]>>s,e=o[1]>>s,i=o[2]>>s,t=r(n,e,i),u[t]=(u[t]||0)+1}),u}function i(r,o){var n,e,i,a=1e6,u=0,f=1e6,c=0,l=1e6,h=0;return r.forEach(function(r){n=r[0]>>s,e=r[1]>>s,i=r[2]>>s,a>n?a=n:n>u&&(u=n),f>e?f=e:e>c&&(c=e),l>i?l=i:i>h&&(h=i)}),new t(a,u,f,c,l,h,o)}function a(o,t){function n(r){var o,n,e,i,a,u=r+"1",f=r+"2",s=0;for(c=t[u];c<=t[f];c++)if(g[c]>p/2){for(e=t.copy(),i=t.copy(),o=c-t[u],n=t[f]-c,a=n>=o?Math.min(t[f]-1,~~(c+n/2)):Math.max(t[u],~~(c-1-o/2));!g[a];)a++;for(s=m[a];!s&&g[a-1];)s=m[--a];return e[f]=a,i[u]=e[f]+1,[e,i]}}if(t.count()){var e=t.r2-t.r1+1,i=t.g2-t.g1+1,a=t.b2-t.b1+1,u=f.max([e,i,a]);if(1==t.count())return[t.copy()];var c,s,l,h,v,p=0,g=[],m=[];if(u==e)for(c=t.r1;c<=t.r2;c++){for(h=0,s=t.g1;s<=t.g2;s++)for(l=t.b1;l<=t.b2;l++)v=r(c,s,l),h+=o[v]||0;p+=h,g[c]=p}else if(u==i)for(c=t.g1;c<=t.g2;c++){for(h=0,s=t.r1;s<=t.r2;s++)for(l=t.b1;l<=t.b2;l++)v=r(s,c,l),h+=o[v]||0;p+=h,g[c]=p}else for(c=t.b1;c<=t.b2;c++){for(h=0,s=t.r1;s<=t.r2;s++)for(l=t.g1;l<=t.g2;l++)v=r(s,l,c),h+=o[v]||0;p+=h,g[c]=p}return g.forEach(function(r,o){m[o]=p-r}),n(u==e?"r":u==i?"g":"b")}}function u(r,t){function u(r,o){for(var t,n=1,e=0;l>e;)if(t=r.pop(),t.count()){var i=a(c,t),u=i[0],f=i[1];if(!u)return;if(r.push(u),f&&(r.push(f),n++),n>=o)return;if(e++>l)return}else r.push(t),e++}if(!r.length||2>t||t>256)return!1;var c=e(r),s=0;c.forEach(function(){s++});var v=i(r,c),p=new o(function(r,o){return f.naturalOrder(r.count(),o.count())});p.push(v),u(p,h*t);for(var g=new o(function(r,o){return f.naturalOrder(r.count()*r.volume(),o.count()*o.volume())});p.size();)g.push(p.pop());u(g,t-g.size());for(var m=new n;g.size();)m.push(g.pop());return m}if(!f)var f={map:function(r,o){var t={};return o?r.map(function(r,n){return t.index=n,o.call(t,r)}):r.slice()},naturalOrder:function(r,o){return o>r?-1:r>o?1:0},sum:function(r,o){var t={};return r.reduce(o?function(r,n,e){return t.index=e,r+o.call(t,n)}:function(r,o){return r+o},0)},max:function(r,o){return Math.max.apply(null,o?f.map(r,o):r)}};var c=5,s=8-c,l=1e3,h=.75;return t.prototype={volume:function(r){var o=this;return o._volume&&!r||(o._volume=(o.r2-o.r1+1)*(o.g2-o.g1+1)*(o.b2-o.b1+1)),o._volume},count:function(o){var t=this,n=t.histo;if(!t._count_set||o){var e,i,a,u=0;for(e=t.r1;e<=t.r2;e++)for(i=t.g1;i<=t.g2;i++)for(a=t.b1;a<=t.b2;a++)index=r(e,i,a),u+=n[index]||0;t._count=u,t._count_set=!0}return t._count},copy:function(){var r=this;return new t(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(o){var t=this,n=t.histo;if(!t._avg||o){var e,i,a,u,f,s=0,l=1<<8-c,h=0,v=0,p=0;for(i=t.r1;i<=t.r2;i++)for(a=t.g1;a<=t.g2;a++)for(u=t.b1;u<=t.b2;u++)f=r(i,a,u),e=n[f]||0,s+=e,h+=e*(i+.5)*l,v+=e*(a+.5)*l,p+=e*(u+.5)*l;s?t._avg=[~~(h/s),~~(v/s),~~(p/s)]:t._avg=[~~(l*(t.r1+t.r2+1)/2),~~(l*(t.g1+t.g2+1)/2),~~(l*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(r){var o=this,t=r[0]>>s;return gval=r[1]>>s,bval=r[2]>>s,t>=o.r1&&t<=o.r2&&gval>=o.g1&&gval<=o.g2&&bval>=o.b1&&bval<=o.b2}},n.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var o=this.vboxes,t=0;t<o.size();t++)if(o.peek(t).vbox.contains(r))return o.peek(t).color;return this.nearest(r)},nearest:function(r){for(var o,t,n,e=this.vboxes,i=0;i<e.size();i++)t=Math.sqrt(Math.pow(r[0]-e.peek(i).color[0],2)+Math.pow(r[1]-e.peek(i).color[1],2)+Math.pow(r[2]-e.peek(i).color[2],2)),(o>t||void 0===o)&&(o=t,n=e.peek(i).color);return n},forcebw:function(){var r=this.vboxes;r.sort(function(r,o){return f.naturalOrder(f.sum(r.color),f.sum(o.color))});var o=r[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(r[0].color=[0,0,0]);var t=r.length-1,n=r[t].color;n[0]>251&&n[1]>251&&n[2]>251&&(r[t].color=[255,255,255])}},{quantize:u}}(),ColorFinder=function(){"use strict";function r(){this._worker=null,o&&(this._worker=new Worker(e.workerPrefixPath+t))}var o="Worker"in window,t="color-finder-worker.js",n=function(r){return Error("ColorFinder: "+r)},e=Object.seal({quality:10,colorsAmount:10,maxColorValue:230,useWebWorker:o,workerPrefixPath:""});return r.prototype.setConfig=function(r,o){if(void 0===e[r])throw n("setConfig: Invalid config key");return e[r]=o,this},r.prototype.getConfig=function(r){if(void 0===e[r])throw n("setConfig: Invalid config key");return e[r]},r.prototype.updateWorker=function(){return this._worker instanceof Worker&&this._worker.terminate(),o&&(this._worker=new Worker(e.workerPrefixPath+t)),this},r.prototype.fromImage=function(r,o){if(!r)throw n("fromImage: Invalid image url");if("function"!=typeof o)throw n("fromImage: Invalid callback");return this._getPopularColor(r,o),this},r.prototype._getPopularColor=function(r,o){if(r){var t=this,n=new Image;n.onload=function(){t._getColorFromImage.call(t,n,o)},n.crossOrigin="",n.src=r}},r.prototype._normalizeColor=function(r,o){if(!(r instanceof Array)||r.length<3)throw n("normalizeColor: Invalid color");if(void 0===o)throw n("normalizeColor: Invalid maxColor");var t=this._arrayMax(r);if(o>=t)return r;var e=t-o;return r[0]=Math.max(r[0]-e,0),r[1]=Math.max(r[1]-e,0),r[2]=Math.max(r[2]-e,0),r},r.prototype._getColorFromImage=function(r,t){var n=this._imageToContext(r),i=n.getImageData(0,0,r.width,r.height);if(e.useWebWorker&&o)this._worker.onmessage=function(r){this._worker.onmessage=void 0;var o,n=r.data;o=r.error?this._processPixelsToColor(i,e.colorsAmount,e.quality)[0]:n.response[0],o=this._normalizeColor(o,e.maxColorValue),t(o)}.bind(this),this._worker.postMessage({data:i,colorsAmount:e.colorsAmount,quality:e.quality});else{var a=this._processPixelsToColor(i,e.colorsAmount,e.quality)[0];a=this._normalizeColor(a,e.maxColorValue),t(a)}},r.prototype._imageToContext=function(r){if(!(r instanceof HTMLImageElement))throw n("_initCanvas: Invalid image");var o=document.createElement("canvas").getContext("2d");return o.canvas.width=r.width,o.canvas.height=r.height,o.drawImage(r,0,0),o},r.prototype._arrayMax=function(r){for(var o=r.length,t=0;--o>-1;)r[o]>t&&(t=r[o]);return t},r.prototype._processPixelsToColor=function(r,o,t){o=+o,t=+t;for(var n,e,i,a,u,f=r.data,c=r.width*r.height,s=[],l=0;c>l;l+=t)n=4*l,e=f[n+0],i=f[n+1],a=f[n+2],u=f[n+3],u>=125&&(250>=e||250>=i||250>=a)&&s.push([e,i,a]);var h=MMCQ.quantize(s,o);return h?h.palette():[]},new r}();